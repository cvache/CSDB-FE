{"ast":null,"code":"var _jsxFileName = \"/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/src/containers/Notes.js\";\nimport React, { useRef, useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport { FormGroup, FormControl, ControlLabel } from 'react-bootstrap';\nimport { API, Storage } from \"aws-amplify\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { s3Upload } from \"../libs/awsLib\";\nimport { onError } from \"../libs/errorLib\";\nimport config from \"../config\";\nimport './Notes.css';\nexport default function Notes() {\n  const file = useRef(null);\n  const {\n    id\n  } = useParams();\n  const history = useHistory();\n  const [note, setNote] = useState(null);\n  const [content, setTitle] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  useEffect(() => {\n    function loadNote() {\n      return API.get(\"notes\", `/images/${id}`);\n    }\n\n    async function onLoad() {\n      try {\n        const note = await loadNote();\n        const {\n          title,\n          imgName\n        } = note;\n\n        if (imgName) {\n          note.attatchmentURL = await Storage.vault.get(imgName);\n        }\n\n        setTitle(title);\n        setNote(note);\n      } catch (e) {\n        onError(e);\n      }\n    }\n\n    onLoad();\n  }, [id]);\n\n  function validateForm() {\n    return content.length > 0;\n  }\n\n  function formatFilename(str) {\n    return str.replace(/^\\w+-/, \"\");\n  }\n\n  function handleFileChange(event) {\n    file.current = event.target.files[0];\n  }\n\n  function saveNote(note) {\n    return API.put(\"notes\", `/notes/${id}`, {\n      body: note\n    });\n  }\n\n  async function handleSubmit(event) {\n    let attachment;\n    event.preventDefault();\n\n    if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n      alert(`Please pick a file smaller than ${config.MAX_ATTACHMENT_SIZE / 1000000} MB.`);\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      if (file.current) {\n        attachment = await s3Upload(file.current);\n      }\n\n      await saveNote({\n        content,\n        attachment: attachment || note.attachment\n      });\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsLoading(false);\n    }\n  }\n\n  function deleteNote() {\n    return API.del(\"notes\", `/notes/${id}`);\n  }\n\n  async function handleDelete(event) {\n    event.preventDefault();\n    const confirmed = window.confirm(\"Are you sure you want to delete this note?\");\n\n    if (!confirmed) {\n      return;\n    }\n\n    setIsDeleting(true);\n\n    try {\n      await deleteNote();\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsDeleting(false);\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"Notes\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 9\n    }\n  }, note && /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FormGroup, {\n    controlId: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(FormControl, {\n    value: content,\n    componentClass: \"textarea\",\n    onChange: e => setTitle(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 25\n    }\n  })), note.attachment && /*#__PURE__*/React.createElement(FormGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(ControlLabel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 29\n    }\n  }, \"Attachment\"), /*#__PURE__*/React.createElement(FormControl.Static, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    href: note.attachmentURL,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 29\n    }\n  }, formatFilename(note.attachment)))), /*#__PURE__*/React.createElement(FormGroup, {\n    controlId: \"file\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 21\n    }\n  }, !note.attachment && /*#__PURE__*/React.createElement(ControlLabel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 42\n    }\n  }, \"Attachment\"), /*#__PURE__*/React.createElement(FormControl, {\n    onChange: handleFileChange,\n    type: \"file\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(LoaderButton, {\n    block: true,\n    type: \"submit\",\n    bsSize: \"large\",\n    bsStyle: \"primary\",\n    isLoading: isLoading,\n    disabled: !validateForm(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 21\n    }\n  }, \"Save\"), /*#__PURE__*/React.createElement(LoaderButton, {\n    block: true,\n    bsSize: \"large\",\n    bsStyle: \"danger\",\n    onClick: handleDelete,\n    isLoading: isDeleting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 21\n    }\n  }, \"Delete\")));\n}","map":{"version":3,"sources":["/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/src/containers/Notes.js"],"names":["React","useRef","useState","useEffect","useParams","useHistory","FormGroup","FormControl","ControlLabel","API","Storage","LoaderButton","s3Upload","onError","config","Notes","file","id","history","note","setNote","content","setTitle","isLoading","setIsLoading","isDeleting","setIsDeleting","loadNote","get","onLoad","title","imgName","attatchmentURL","vault","e","validateForm","length","formatFilename","str","replace","handleFileChange","event","current","target","files","saveNote","put","body","handleSubmit","attachment","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","push","deleteNote","del","handleDelete","confirmed","window","confirm","value","attachmentURL"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport { FormGroup, FormControl, ControlLabel } from 'react-bootstrap';\nimport { API, Storage } from \"aws-amplify\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { s3Upload } from \"../libs/awsLib\";\nimport { onError } from \"../libs/errorLib\";\nimport config from \"../config\";\nimport './Notes.css';\n\n\nexport default function Notes() {\n    const file = useRef(null);\n    const {id} = useParams();\n    const history = useHistory();\n    const [note, setNote] = useState(null);\n    const [content, setTitle] = useState(\"\");\n    const [isLoading, setIsLoading] = useState(false);\n    const [isDeleting, setIsDeleting] = useState(false);\n\n    useEffect(() => {\n        function loadNote() {\n            return API.get(\"notes\", `/images/${id}`);\n        }\n\n        async function onLoad() {\n            try {\n                const note = await loadNote();\n                const {title, imgName} = note;\n                \n                if (imgName) {\n                    note.attatchmentURL = await Storage.vault.get(imgName);\n                }\n\n                setTitle(title);\n                setNote(note);\n            } catch (e) {\n                onError(e);\n            }\n        }\n\n        onLoad();\n    }, [id]);\n\n    function validateForm() {\n        return content.length > 0;\n    }\n\n    function formatFilename(str) {\n        return str.replace(/^\\w+-/, \"\");\n    }\n\n    function handleFileChange(event) {\n        file.current = event.target.files[0];\n    }\n\n    function saveNote(note) {\n        return API.put(\"notes\", `/notes/${id}`, {\n          body: note\n        });\n      }\n      \n      async function handleSubmit(event) {\n        let attachment;\n      \n        event.preventDefault();\n      \n        if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n          alert(\n            `Please pick a file smaller than ${\n              config.MAX_ATTACHMENT_SIZE / 1000000\n            } MB.`\n          );\n          return;\n        }\n      \n        setIsLoading(true);\n      \n        try {\n          if (file.current) {\n            attachment = await s3Upload(file.current);\n          }\n      \n          await saveNote({\n            content,\n            attachment: attachment || note.attachment\n          });\n          history.push(\"/\");\n        } catch (e) {\n          onError(e);\n          setIsLoading(false);\n        }\n      }\n\n    function deleteNote() {\n        return API.del(\"notes\", `/notes/${id}`);\n    }\n    \n    async function handleDelete(event) {\n        event.preventDefault();\n    \n        const confirmed = window.confirm(\n            \"Are you sure you want to delete this note?\"\n        );\n    \n        if (!confirmed) {\n            return;\n        }\n        \n        setIsDeleting(true);\n        \n        try {\n            await deleteNote();\n            history.push(\"/\");\n        } catch (e) {\n            onError(e);\n            setIsDeleting(false);\n        }\n    }\n\n    return (\n        <div className='Notes'>\n            {note && (\n                <form onSubmit={handleSubmit}>\n                    <FormGroup controlId='content'>\n                        <FormControl\n                            value={content}\n                            componentClass=\"textarea\"\n                            onChange={ e => setTitle(e.target.value)}\n                        />\n                    </FormGroup>\n                    {note.attachment && (\n                        <FormGroup>\n                            <ControlLabel>Attachment</ControlLabel>\n                            <FormControl.Static>\n                            <a\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                href={note.attachmentURL}\n                            >\n                                {formatFilename(note.attachment)}\n                            </a>\n                            </FormControl.Static>\n                        </FormGroup>\n                    )}\n                    <FormGroup controlId=\"file\">\n                    {!note.attachment && <ControlLabel>Attachment</ControlLabel>}\n                    <FormControl onChange={handleFileChange} type=\"file\" />\n                    </FormGroup>\n                    <LoaderButton\n                    block\n                    type=\"submit\"\n                    bsSize=\"large\"\n                    bsStyle=\"primary\"\n                    isLoading={isLoading}\n                    disabled={!validateForm()}\n                    >\n                    Save\n                    </LoaderButton>\n                    <LoaderButton\n                    block\n                    bsSize=\"large\"\n                    bsStyle=\"danger\"\n                    onClick={handleDelete}\n                    isLoading={isDeleting}\n                    >\n                    Delete\n                    </LoaderButton>\n                </form>\n            )}\n        </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}