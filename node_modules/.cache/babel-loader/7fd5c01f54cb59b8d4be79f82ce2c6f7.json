{"ast":null,"code":"import _regeneratorRuntime from\"/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState}from\"react\";import{API}from\"aws-amplify\";import{useHistory}from\"react-router-dom\";import{FormGroup,FormControl,ControlLabel}from\"react-bootstrap\";import LoaderButton from\"../components/LoaderButton\";import{onError}from\"../libs/errorLib\";import{s3Upload}from\"../libs/awsLib\";import config from\"../config\";import getExif from'exif-js';import\"./UploadImage.css\";export default function UploadImage(){var file=useRef(null);var history=useHistory();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),tags=_useState4[0],setTags=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];function handleFileChange(event){file.current=event.target.files[0];}/*\n  function validateTags() {\n      return true;\n  }\n  */function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var attachment,metadataFile,comments,metadata;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(file.current&&file.current.size>config.MAX_ATTACHMENT_SIZE)){_context.next=4;break;}alert(\"Please pick a file smaller than \".concat(config.MAX_ATTACHMENT_SIZE/1000000,\" MB.\"));return _context.abrupt(\"return\");case 4:setIsLoading(true);_context.prev=5;if(!file.current){_context.next=12;break;}_context.next=9;return s3Upload(file.current);case 9:_context.t0=_context.sent;_context.next=13;break;case 12:_context.t0=null;case 13:attachment=_context.t0;//scrub metadata here to avoid sending img file to REST and THEN to S3.\n//Doing it here allows us to just send the metadata as is\nmetadataFile=getExif(file.current);comments=[];metadata={size:metadataFile.EXIFwrapped.size,type:metadataFile.EXIFwrapped.type};_context.next=19;return createNote({title:title,attachment:attachment,metadata:metadata,tags:tags,comments:comments});case 19:history.push(\"/\");_context.next=26;break;case 22:_context.prev=22;_context.t1=_context[\"catch\"](5);onError(_context.t1);setIsLoading(false);case 26:case\"end\":return _context.stop();}}},_callee,null,[[5,22]]);}));return _handleSubmit.apply(this,arguments);}function createNote(note){console.log(note);return API.post(\"notes\",\"/images\",{body:note});}return/*#__PURE__*/React.createElement(\"div\",{className:\"UploadImage\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(FormGroup,{controlId:\"content\"},/*#__PURE__*/React.createElement(ControlLabel,null,\"Title\"),/*#__PURE__*/React.createElement(FormControl,{value:title,type:\"text\",placeholder:\"Image Title\",onChange:function onChange(e){return setTitle(e.target.value);},required:true})),/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(ControlLabel,null,\"Tags\"),/*#__PURE__*/React.createElement(FormControl,{value:tags,type:\"text\",placeholder:\"Tag 1, Tag 2, Tag 3\",onChange:function onChange(e){return setTags(e.target.value);}})),/*#__PURE__*/React.createElement(FormGroup,{controlId:\"file\"},/*#__PURE__*/React.createElement(ControlLabel,null,\"Attachment\"),/*#__PURE__*/React.createElement(FormControl,{onChange:handleFileChange,type:\"file\",required:true})),/*#__PURE__*/React.createElement(LoaderButton,{block:true,type:\"submit\",bsSize:\"large\",bsStyle:\"primary\",isLoading:isLoading},\"Create\")));}","map":{"version":3,"sources":["/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/src/containers/UploadImage.js"],"names":["React","useRef","useState","API","useHistory","FormGroup","FormControl","ControlLabel","LoaderButton","onError","s3Upload","config","getExif","UploadImage","file","history","title","setTitle","tags","setTags","isLoading","setIsLoading","handleFileChange","event","current","target","files","handleSubmit","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","attachment","metadataFile","comments","metadata","EXIFwrapped","type","createNote","push","note","console","log","post","body","e","value"],"mappings":"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","sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { API } from \"aws-amplify\";\nimport { useHistory } from \"react-router-dom\";\nimport {FormGroup, FormControl, ControlLabel } from \"react-bootstrap\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { onError } from \"../libs/errorLib\";\nimport { s3Upload } from \"../libs/awsLib\";\nimport config from \"../config\";\nimport getExif from 'exif-js'\nimport \"./UploadImage.css\";\n\nexport default function UploadImage() {\n    const file = useRef(null);\n  const history = useHistory();\n  const [title, setTitle] = useState(\"\");\n  const [tags, setTags] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n\n  function handleFileChange(event) {\n    file.current = event.target.files[0];\n  }\n\n  /*\n  function validateTags() {\n      return true;\n  }\n  */\n\n  async function handleSubmit(event) {\n    event.preventDefault();\n\n    if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n      alert(\n        `Please pick a file smaller than ${\n          config.MAX_ATTACHMENT_SIZE / 1000000\n        } MB.`\n      );\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const attachment = file.current ? await s3Upload(file.current) : null;\n      //scrub metadata here to avoid sending img file to REST and THEN to S3.\n      //Doing it here allows us to just send the metadata as is\n      const metadataFile = getExif(file.current);\n      const comments = [];\n      const metadata = {\n          size: metadataFile.EXIFwrapped.size,\n          type: metadataFile.EXIFwrapped.type\n    };\n\n\n      await createNote({ title, attachment, metadata, tags, comments });\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsLoading(false);\n    }\n  }\n\n  function createNote(note) {\n    console.log(note);\n\n    return API.post(\"notes\", \"/images\", {\n      body: note\n    });\n  }\n\n  return (\n    <div className=\"UploadImage\">\n      <form onSubmit={handleSubmit}>\n\n        <FormGroup controlId=\"content\">\n            <ControlLabel>Title</ControlLabel>\n            <FormControl\n                value={title}\n                type='text'\n                placeholder=\"Image Title\"\n                onChange={e => setTitle(e.target.value)}\n                required\n            />\n        </FormGroup>\n\n        <FormGroup>\n            <ControlLabel>Tags</ControlLabel>\n            <FormControl\n                value={tags}\n                type='text'\n                placeholder='Tag 1, Tag 2, Tag 3'\n                onChange={e => setTags(e.target.value)}\n            />\n        </FormGroup>\n\n        <FormGroup controlId=\"file\">\n          <ControlLabel>Attachment</ControlLabel>\n          <FormControl onChange={handleFileChange} type=\"file\" required/>\n        </FormGroup>\n\n        <LoaderButton\n          block\n          type=\"submit\"\n          bsSize=\"large\"\n          bsStyle=\"primary\"\n          isLoading={isLoading}\n        >\n          Create\n        </LoaderButton>\n\n      </form>\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}