{"ast":null,"code":"var _jsxFileName = \"/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/src/containers/Notes.js\";\nimport React, { useRef, useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport { Tabs, Tab, Image } from 'react-bootstrap';\nimport { API, Storage } from \"aws-amplify\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { s3Upload } from \"../libs/awsLib\";\nimport { onError } from \"../libs/errorLib\";\nimport config from \"../config\";\nimport './Notes.css';\nexport default function Notes() {\n  const file = useRef(null);\n  const {\n    id\n  } = useParams();\n  const history = useHistory();\n  const [image, setImage] = useState(null);\n  const [content, setTitle] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  useEffect(() => {\n    function loadImage() {\n      return API.get(\"notes\", `/images/${id}`);\n    }\n\n    async function onLoad() {\n      try {\n        const image = await loadImage();\n        const {\n          title,\n          imgName\n        } = image;\n\n        if (imgName) {\n          image.attatchmentURL = await Storage.vault.get(imgName);\n        }\n\n        setTitle(title);\n        setImage(image);\n      } catch (e) {\n        onError(e);\n      }\n    }\n\n    onLoad();\n  }, [id]);\n\n  function formatFilename(str) {\n    return str.replace(/^\\w+-/, \"\");\n  }\n\n  function handleFileChange(event) {\n    file.current = event.target.files[0];\n  }\n\n  function saveNote(note) {\n    return API.put(\"notes\", `/notes/${id}`, {\n      body: note\n    });\n  }\n\n  async function handleSubmit(event) {\n    let attachment;\n    event.preventDefault();\n\n    if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n      alert(`Please pick a file smaller than ${config.MAX_ATTACHMENT_SIZE / 1000000} MB.`);\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      if (file.current) {\n        attachment = await s3Upload(file.current);\n      }\n\n      await saveNote({\n        content,\n        attachment: attachment || image.attachment\n      });\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsLoading(false);\n    }\n  }\n\n  function deleteNote() {\n    return API.del(\"notes\", `/notes/${id}`);\n  }\n\n  async function handleDelete(event) {\n    event.preventDefault();\n    const confirmed = window.confirm(\"Are you sure you want to delete this note?\");\n\n    if (!confirmed) {\n      return;\n    }\n\n    setIsDeleting(true);\n\n    try {\n      await deleteNote();\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsDeleting(false);\n    }\n  }\n\n  console.log(image);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ImgSection\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    defaultActiveKey: \"Image\",\n    id: \"infoTabs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    eventKey: \"Image\",\n    title: \"Image\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Image, {\n    src: \"image.attatchmentURL\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 21\n    }\n  }))));\n}","map":{"version":3,"sources":["/Users/carsonvache/Documents/CrowdsourcedMedicalImageDatabase/Site/FE/src/containers/Notes.js"],"names":["React","useRef","useState","useEffect","useParams","useHistory","Tabs","Tab","Image","API","Storage","LoaderButton","s3Upload","onError","config","Notes","file","id","history","image","setImage","content","setTitle","isLoading","setIsLoading","isDeleting","setIsDeleting","loadImage","get","onLoad","title","imgName","attatchmentURL","vault","e","formatFilename","str","replace","handleFileChange","event","current","target","files","saveNote","note","put","body","handleSubmit","attachment","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","push","deleteNote","del","handleDelete","confirmed","window","confirm","console","log"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport { Tabs, Tab, Image } from 'react-bootstrap';\nimport { API, Storage } from \"aws-amplify\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { s3Upload } from \"../libs/awsLib\";\nimport { onError } from \"../libs/errorLib\";\nimport config from \"../config\";\nimport './Notes.css';\n\n\nexport default function Notes() {\n    const file = useRef(null);\n    const {id} = useParams();\n    const history = useHistory();\n    const [image, setImage] = useState(null);\n    const [content, setTitle] = useState(\"\");\n    const [isLoading, setIsLoading] = useState(false);\n    const [isDeleting, setIsDeleting] = useState(false);\n\n    useEffect(() => {\n        function loadImage() {\n            return API.get(\"notes\", `/images/${id}`);\n        }\n\n        async function onLoad() {\n            try {\n                const image = await loadImage();\n                const {title, imgName} = image;\n                \n                if (imgName) {\n                    image.attatchmentURL = await Storage.vault.get(imgName);\n                }\n\n                setTitle(title);\n                setImage(image);\n            } catch (e) {\n                onError(e);\n            }\n        }\n\n        onLoad();\n    }, [id]);\n\n    function formatFilename(str) {\n        return str.replace(/^\\w+-/, \"\");\n    }\n\n    function handleFileChange(event) {\n        file.current = event.target.files[0];\n    }\n\n    function saveNote(note) {\n        return API.put(\"notes\", `/notes/${id}`, {\n          body: note\n        });\n      }\n      \n      async function handleSubmit(event) {\n        let attachment;\n      \n        event.preventDefault();\n      \n        if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n          alert(\n            `Please pick a file smaller than ${\n              config.MAX_ATTACHMENT_SIZE / 1000000\n            } MB.`\n          );\n          return;\n        }\n      \n        setIsLoading(true);\n      \n        try {\n          if (file.current) {\n            attachment = await s3Upload(file.current);\n          }\n      \n          await saveNote({\n            content,\n            attachment: attachment || image.attachment\n          });\n          history.push(\"/\");\n        } catch (e) {\n          onError(e);\n          setIsLoading(false);\n        }\n      }\n\n    function deleteNote() {\n        return API.del(\"notes\", `/notes/${id}`);\n    }\n    \n    async function handleDelete(event) {\n        event.preventDefault();\n    \n        const confirmed = window.confirm(\n            \"Are you sure you want to delete this note?\"\n        );\n    \n        if (!confirmed) {\n            return;\n        }\n        \n        setIsDeleting(true);\n        \n        try {\n            await deleteNote();\n            history.push(\"/\");\n        } catch (e) {\n            onError(e);\n            setIsDeleting(false);\n        }\n    }\n\n    console.log(image);\n    return (\n        <div className='ImgSection'>\n            <Tabs defaultActiveKey='Image' id='infoTabs'>\n                <Tab eventKey='Image' title='Image'>\n                    <Image src='image.attatchmentURL'></Image>\n                </Tab>\n            </Tabs>\n        </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}